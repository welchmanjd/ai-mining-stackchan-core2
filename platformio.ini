; PlatformIO Project Configuration File

[platformio]
default_envs = m5stack-core2
src_dir = src


; ===== 共通設定（全envの土台）=====
[env]
platform = espressif32
board = m5stack-core2
framework = arduino

monitor_speed = 115200
monitor_filters = esp32_exception_decoder, time
upload_speed = 921600
upload_flags =
  --connect-attempts=20
upload_port = COM3

monitor_dtr = 0
monitor_rts = 0

board_build.f_cpu = 240000000L
board_build.flash_mode = dio
board_build.f_flash = 80000000L

lib_deps =
  m5stack/M5Unified@0.1.16
  meganetaaan/M5Stack-Avatar@0.9.2
  ArduinoJson


; ===== 開発用（通常ビルド / NORMAL）=====
; ---- Debug tips: touch logs ----
; 普段は [TOUCH] を出さない（INFO壁紙化防止）
; 必要なときだけ以下を build_flags に一時的に追加して復活させる:
;   -DEVT_DEBUG_ENABLED=1        ; EVT系DEBUG + TOUCHも追従して出る
;   -DTOUCH_DEBUG_ENABLED=1      ; TOUCHだけ個別に出す（EVTとは独立）
; ※終わったら必ずOFFに戻す（ログが流れすぎるため）
[env:m5stack-core2]
extends = env
build_type = debug
build_flags =
  -DCORE_DEBUG_LEVEL=0
  -DMC_LOG_LEVEL=1
; 普段はOFF（ログ壁紙化防止）
; 必要なときだけ一時的にON：
;   -DEVT_DEBUG_ENABLED=1        ; EVT系DEBUG + TOUCHも追従
;   -DTOUCH_DEBUG_ENABLED=1      ; TOUCHだけ個別にON
build_src_filter =
  +<*>
  -<ai_sandbox_main.cpp>


; ===== QUIET（公開/常用）=====
; EVTは残しつつ、通常ログを極力静かにする想定
[env:m5stack-core2_quiet]
extends = env:m5stack-core2
build_unflags =
  -DMC_LOG_LEVEL=1
build_flags =
  ${env:m5stack-core2.build_flags}
  -DMC_LOG_LEVEL=0


; ===== DIAG（調査）=====
; 失敗系詳細や抑制理由、状態遷移理由を増やす想定
[env:m5stack-core2_diag]
extends = env:m5stack-core2
build_unflags =
  -DMC_LOG_LEVEL=1
build_flags =
  ${env:m5stack-core2.build_flags}
  -DMC_LOG_LEVEL=2
; 必要なときだけ個別にON（実装が入ったら使う）
;  -DMC_LOG_STT_SSL=1
;  -DMC_LOG_REC_I2S=1


; ===== TRACE（短時間の追跡）=====
; ほぼ全部出す（常用しない）
[env:m5stack-core2_trace]
extends = env:m5stack-core2
build_unflags =
  -DMC_LOG_LEVEL=1
build_flags =
  ${env:m5stack-core2.build_flags}
  -DMC_LOG_LEVEL=3
  -DTOUCH_DEBUG_ENABLED=1
; TRACEでだけ許容する個別スイッチ（実装が入ったら使う）
;  -DMC_LOG_STT_SSL=1
;  -DMC_LOG_REC_I2S=1


; ===== 配布用（空設定でビルドしたい）=====
[env:m5stack-core2-dist]
extends = env:m5stack-core2
build_type = release

; 親の CORE_DEBUG_LEVEL / MC_LOG_LEVEL を外してから、0 を入れる（警告消し）
build_unflags =
  -DCORE_DEBUG_LEVEL=3
  -DMC_LOG_LEVEL=1
  -Os

build_flags =
  -DMC_DISABLE_CONFIG_PRIVATE=1
  -DCORE_DEBUG_LEVEL=0
  -DMC_LOG_LEVEL=0
  -O3
  -fno-if-conversion


; ===== TTSベンチ（test側のmainを使う）=====
[env:tts-bench]
extends = env:m5stack-core2
build_src_filter =
  +<*>
  -<main.cpp>
  -<ai_sandbox_main.cpp>
  -<ai_talk_controller.cpp>
  +<../test/tts-bench/main.cpp>


; ===== QIOテスト用 =====
[env:m5stack-core2-qio]
extends = env:m5stack-core2
board_build.flash_mode = qio
board_build.f_flash = 80000000L


[env:ai-sandbox]
extends = env:m5stack-core2

; sandbox 入口（setup/loop）は ai_sandbox_main.cpp を使う
; main.cpp を外して、それ以外は通常どおりコンパイルする
build_src_filter =
  +<*>
  -<main.cpp>
