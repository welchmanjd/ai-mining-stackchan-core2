; PlatformIO Project Configuration File

[platformio]
default_envs = m5stack-core2
src_dir = src


; ===== Common settings (env base) =====
[env]
platform = espressif32
board = m5stack-core2
framework = arduino

monitor_speed = 115200
monitor_filters = esp32_exception_decoder, time
upload_speed = 921600
upload_flags =
  --connect-attempts=20
upload_port = COM3

monitor_dtr = 0
monitor_rts = 0

board_build.f_cpu = 240000000L
board_build.flash_mode = dio
board_build.f_flash = 80000000L

lib_deps =
  m5stack/M5Unified@0.1.16
  meganetaaan/M5Stack-Avatar@0.9.2
  ArduinoJson


; ===== Development / normal build =====
; ---- Debug tips: touch logs ----
; Keep [TOUCH] logs quiet by default to avoid log spam.
; Temporarily add these to build_flags when needed:
;   -DEVT_DEBUG_ENABLED=1        ; EVT debug + TOUCH follows
;   -DTOUCH_DEBUG_ENABLED=1      ; TOUCH only (independent of EVT)
; Remember to turn them off when done.
[env:m5stack-core2]
extends = env
build_type = debug
build_flags =
  -DCORE_DEBUG_LEVEL=0
  -DMC_LOG_LEVEL=3
  -Wno-deprecated-declarations
; Keep logging quiet by default. Enable only when needed:
;   -DEVT_DEBUG_ENABLED=1        ; EVT debug + TOUCH follows
;   -DTOUCH_DEBUG_ENABLED=1      ; TOUCH only
build_src_filter =
  +<*>


; ===== QUIET (daily use) =====
; Keep EVT logs but make normal logs as quiet as possible.
[env:m5stack-core2_quiet]
extends = env:m5stack-core2
build_unflags =
  -DMC_LOG_LEVEL=1
build_flags =
  ${env:m5stack-core2.build_flags}
  -DMC_LOG_LEVEL=0


; ===== DIAG (investigation) =====
; Increase diagnostics for failures and state transitions.
[env:m5stack-core2_diag]
extends = env:m5stack-core2
build_unflags =
  -DMC_LOG_LEVEL=1
build_flags =
  ${env:m5stack-core2.build_flags}
  -DMC_LOG_LEVEL=2
; Optional flags (enable only when needed):
;  -DMC_LOG_STT_SSL=1
;  -DMC_LOG_REC_I2S=1


; ===== TRACE (short-term tracing) =====
; Emit almost everything (do not use for long runs).
[env:m5stack-core2_trace]
extends = env:m5stack-core2
build_unflags =
  -DMC_LOG_LEVEL=1
build_flags =
  ${env:m5stack-core2.build_flags}
  -DMC_LOG_LEVEL=3
  -DTOUCH_DEBUG_ENABLED=1
; Optional flags (enable only when needed):
;  -DMC_LOG_STT_SSL=1
;  -DMC_LOG_REC_I2S=1


; ===== Dist build (no private config) =====
[env:m5stack-core2-dist]
extends = env:m5stack-core2
build_type = release

; Remove parent CORE_DEBUG_LEVEL / MC_LOG_LEVEL, then add release flags.
build_unflags =
  -DCORE_DEBUG_LEVEL=3
  -DMC_LOG_LEVEL=1
  -Os

build_flags =
  -DMC_DISABLE_CONFIG_PRIVATE=1
  -DCORE_DEBUG_LEVEL=0
  -DMC_LOG_LEVEL=0
  -O3
  -fno-if-conversion


; ===== TTS bench (use test main) =====
[env:tts-bench]
extends = env:m5stack-core2
build_src_filter =
  +<*>
  -<main.cpp>
  -<ai_talk_controller.cpp>
  +<../test/tts-bench/main.cpp>


; ===== QIO test =====
[env:m5stack-core2-qio]
extends = env:m5stack-core2
board_build.flash_mode = qio
board_build.f_flash = 80000000L






